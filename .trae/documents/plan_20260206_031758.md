I have identified that the "infinite loading" issue is caused by a deadlock or blocking RLS policy when querying the `user_roles` table directly in `fetchUserRoleData`. The application hangs when trying to fetch the user's role during session initialization.

To resolve this, I will refactor the authentication logic to rely on the `get_my_companies` RPC (which uses `SECURITY DEFINER` to safely bypass RLS) instead of querying `user_roles` directly. This is also more correct for the multi-company architecture where a user's role depends on the active company.

Plan:

1. **Verify RPC Functionality**: Create and run a script to confirm that `get_my_companies` RPC works correctly for the admin user.
2. **Refactor** **`useSupabaseAuth.tsx`**:

   * Modify `updateActiveCompany` to update the global `role` and `companyId` states when the active company changes.

   * Remove the `fetchUserRoleData` function and its calls in `checkSession`, `onAuthStateChange`, and `signIn`.

   * Update `checkSession` to rely solely on `refreshCompanies()` to initialize the state.

   * Update `signIn` to fetch companies and return the role from the default/active company.
3. **Verify Fix**:

   * Reload the application and confirm that the dashboard loads correctly without hanging.

   * Verify that the correct role and company are selected.

