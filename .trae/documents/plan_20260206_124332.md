I have identified the logic flaw causing the loop.

**The Loop Mechanism:**
1.  **JoinCompany.tsx**:
    -   Calls `refreshCompanies()`.
    -   Redirects to `/select-company`.
2.  **SelectCompany.tsx**:
    -   Checks `if (!isLoading && !isRefreshing && companies.length === 0)`.
    -   If true, redirects *back* to `/join-company`.

**The Root Cause:**
Even though `refreshCompanies()` is called, the `companies` array in `SelectCompany.tsx` might still be empty if:
1.  The context update hasn't propagated yet (React state batching).
2.  The `refreshCompanies` function finishes but the component re-renders with the *old* empty array before the new one is set.
3.  Or, most likely, `refreshCompanies` is updating the state, but `SelectCompany` mounts and runs its effect *before* the context has fully settled the new non-empty array.

**The Fix:**
I need to make `SelectCompany.tsx` more patient. It shouldn't redirect immediately if `companies` is empty. It should perhaps wait or show a "No companies found" state with a button to join, rather than auto-redirecting.
However, for a seamless flow, auto-redirect is nice.

**Better approach**:
In `JoinCompany.tsx`, we already know we joined successfully. We should trust that.
I will modify `SelectCompany.tsx` to:
1.  **Remove the auto-redirect to `/join-company`** inside the `useEffect`. Instead, render a "No Companies Found" UI with a button to go to "Join Company". This prevents the infinite automatic loop.
2.  This allows the user to see *why* they are there ("You don't have any companies yet") and manually click "Join" if needed, breaking the loop.
3.  Crucially, if the data *does* load a split second later, the UI will update to show the companies (or auto-select the single one) without having kicked the user out.

I will update `client/pages/SelectCompany.tsx` to remove the aggressive redirect.