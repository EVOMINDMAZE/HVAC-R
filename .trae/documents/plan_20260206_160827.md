# Phase 1: Debug & Fix isLoading State (Highest Priority)

## Step 1: Isolate the Race Condition
- Add debug timestamps to track execution order of `checkSession` vs `onAuthStateChange`
- Implement a mutex/lock to prevent concurrent `refreshCompanies` calls
- Add console.group for better log organization

## Step 2: Fix State Update Guarantees
- Wrap `setIsLoading(false)` in `setTimeout(() => setIsLoading(false), 0)` to ensure React batch updates don't block
- Add `useEffect` dependency cleanup to prevent memory leaks
- Implement loading state timeouts (10s max) with fallback UI

## Step 3: Verify Context Propagation
- Add `useDebugValue` to auth hook for React DevTools inspection
- Create a minimal test component to isolate auth state consumption
- Verify `ProtectedRoute` re-renders when `isLoading` changes

# Phase 2: Fix Create Company Flow

## Step 4: Skool Verification Optimization
- Add loading state timeouts to RPC calls (currently 10s in fetchCompanies)
- Implement retry logic with exponential backoff
- Add fallback UI for network failures

## Step 5: UI State Management
- Add loading skeletons instead of blocking spinners
- Implement error boundaries around RPC calls
- Add optimistic UI updates for better UX

# Phase 3: Polish Sign-Out & Session Management

## Step 6: Consolidate Sign-Out Logic
- Create single `useSignOut` hook with consistent error handling
- Fix dropdown positioning and visibility issues
- Add confirmation dialogs for destructive actions

## Step 7: Session Validation
- Implement session heartbeat to detect stale sessions
- Add automatic redirect on session expiration
- Test session clearing across all authentication methods

# Phase 4: Testing & Validation

## Step 8: End-to-End Testing
- Use Playwright to test complete onboarding flow
- Create test user with no companies → create company flow
- Verify all redirects and state transitions work

## Step 9: Performance Optimization
- Implement React.memo for auth context consumers
- Add request deduplication for RPC calls
- Optimize re-renders with useMemo for computed values

# Success Criteria
1. ✅ Create Company page loads within 2 seconds
2. ✅ Skool verification completes and shows form
3. ✅ Company creation works end-to-end
4. ✅ Sign-out clears all session data
5. ✅ No infinite loading spinners
6. ✅ Mobile responsive UI works correctly